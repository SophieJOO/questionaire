<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>í™˜ì ì„¤ë¬¸ ë¶„ì„ ì‹œìŠ¤í…œ - ì•„í˜„ì¬í•œì˜ì›</title>
  <style>
    :root {
      --primary: #2c5f2d;
      --primary-light: #97bc62;
      --bg: #f5f5f5;
      --card-bg: #ffffff;
      --text: #333333;
      --border: #ddd;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
      background-color: var(--bg);
      color: var(--text);
      line-height: 1.6;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    header {
      background: linear-gradient(135deg, var(--primary), var(--primary-light));
      color: white;
      padding: 30px 20px;
      text-align: center;
      margin-bottom: 30px;
      border-radius: 10px;
    }

    header h1 {
      font-size: 1.8rem;
      margin-bottom: 10px;
    }

    header p {
      opacity: 0.9;
      font-size: 0.95rem;
    }

    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .tab {
      padding: 12px 24px;
      background: var(--card-bg);
      border: 2px solid var(--border);
      border-radius: 8px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.3s;
    }

    .tab:hover {
      border-color: var(--primary);
    }

    .tab.active {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    .content {
      display: none;
    }

    .content.active {
      display: block;
    }

    .card {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    .card h2 {
      color: var(--primary);
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid var(--primary-light);
    }

    .form-section {
      margin-bottom: 25px;
    }

    .form-section h3 {
      color: var(--primary);
      margin-bottom: 15px;
      font-size: 1.1rem;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: #555;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 6px;
      font-size: 1rem;
      transition: border-color 0.3s;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--primary);
    }

    .form-group textarea {
      min-height: 80px;
      resize: vertical;
    }

    .checkbox-group {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .checkbox-group label {
      display: flex;
      align-items: center;
      gap: 5px;
      cursor: pointer;
      padding: 5px 10px;
      background: #f8f8f8;
      border-radius: 5px;
      font-weight: normal;
    }

    .checkbox-group input[type="checkbox"] {
      width: auto;
    }

    .btn {
      padding: 12px 30px;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
    }

    .btn-primary:hover {
      background: #1e4620;
    }

    .btn-secondary {
      background: #6c757d;
      color: white;
    }

    .btn-secondary:hover {
      background: #545b62;
    }

    .btn-copy {
      background: var(--primary-light);
      color: white;
    }

    .btn-copy:hover {
      background: #7da64e;
    }

    .result-area {
      margin-top: 30px;
    }

    .chart-output {
      background: #1a1a1a;
      color: #00ff00;
      padding: 20px;
      border-radius: 8px;
      font-family: 'D2Coding', 'Consolas', monospace;
      font-size: 0.9rem;
      white-space: pre-wrap;
      word-break: break-word;
      overflow-x: auto;
      line-height: 1.5;
    }

    .analysis-section {
      margin-top: 20px;
      padding: 20px;
      background: #f9f9f9;
      border-radius: 8px;
      border-left: 4px solid var(--primary);
    }

    .analysis-section h4 {
      color: var(--primary);
      margin-bottom: 10px;
    }

    .loading {
      display: none;
      text-align: center;
      padding: 40px;
    }

    .loading.show {
      display: block;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 4px solid var(--border);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .btn-group {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .info-box {
      background: #e8f5e9;
      border: 1px solid var(--primary-light);
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
    }

    .info-box h4 {
      color: var(--primary);
      margin-bottom: 8px;
    }

    .info-box ul {
      margin-left: 20px;
    }

    .tally-link {
      display: inline-block;
      padding: 15px 25px;
      background: #6366f1;
      color: white;
      text-decoration: none;
      border-radius: 8px;
      font-weight: 500;
      margin: 10px 0;
    }

    .tally-link:hover {
      background: #4f46e5;
    }

    @media (max-width: 768px) {
      .tabs {
        flex-direction: column;
      }

      .form-grid {
        grid-template-columns: 1fr;
      }

      .btn-group {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>í™˜ì ì„¤ë¬¸ AI ë¶„ì„ ì‹œìŠ¤í…œ</h1>
      <p>Tally ì„¤ë¬¸ ê²°ê³¼ë¥¼ AIë¡œ ë¶„ì„í•˜ì—¬ ì²´ì§ˆê³¼ ì˜ˆìƒì§ˆí™˜ì„ ì‚¬ì „ì— íŒŒì•…í•©ë‹ˆë‹¤</p>
    </header>

    <div class="tabs">
      <div class="tab active" data-tab="tally">Tally ì„¤ë¬¸ ì—°ë™</div>
      <div class="tab" data-tab="manual">ìˆ˜ë™ ì…ë ¥</div>
      <div class="tab" data-tab="results">ë¶„ì„ ê²°ê³¼</div>
    </div>

    <!-- Tally ì„¤ë¬¸ ì—°ë™ íƒ­ -->
    <div id="tally" class="content active">
      <div class="card">
        <h2>Tally ì„¤ë¬¸ì§€ ì•ˆë‚´</h2>

        <div class="info-box">
          <h4>ì‚¬ìš© ë°©ë²•</h4>
          <ul>
            <li>í™˜ìì—ê²Œ ì•„ë˜ ì„¤ë¬¸ì§€ ë§í¬ë¥¼ ì „ì†¡í•©ë‹ˆë‹¤</li>
            <li>í™˜ìê°€ ì„¤ë¬¸ì„ ì™„ë£Œí•˜ë©´ ìë™ìœ¼ë¡œ AI ë¶„ì„ì´ ìˆ˜í–‰ë©ë‹ˆë‹¤</li>
            <li>ë¶„ì„ ê²°ê³¼ëŠ” "ë¶„ì„ ê²°ê³¼" íƒ­ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
          </ul>
        </div>

        <h3>ì„±ì¸ìš© ì„¤ë¬¸ì§€</h3>
        <a href="https://tally.so/r/3XVKVO" target="_blank" class="tally-link">
          ğŸ“‹ ì„±ì¸ í•œì•½ ì„¤ë¬¸ì§€ ì—´ê¸°
        </a>

        <div style="margin-top: 30px;">
          <h3>ì˜ˆì •ëœ ì„¤ë¬¸ì§€</h3>
          <ul style="margin-left: 20px; margin-top: 10px;">
            <li>ì²­ì†Œë…„ìš© ì„¤ë¬¸ì§€ (ì¤€ë¹„ ì¤‘)</li>
            <li>ë‹¤ì´ì–´íŠ¸ ì „ìš© ì„¤ë¬¸ì§€ (ì¤€ë¹„ ì¤‘)</li>
            <li>ìë™ì°¨ë³´í—˜ìš© ì„¤ë¬¸ì§€ (ì¤€ë¹„ ì¤‘)</li>
          </ul>
        </div>

        <div style="margin-top: 30px;">
          <h3>Webhook ì„¤ì •</h3>
          <p style="margin-top: 10px; color: #666;">
            Tally ì„¤ë¬¸ì§€ ì„¤ì •ì—ì„œ ì•„ë˜ Webhook URLì„ ë“±ë¡í•˜ë©´ ìë™ìœ¼ë¡œ ë°ì´í„°ê°€ ì—°ë™ë©ë‹ˆë‹¤:
          </p>
          <code style="display: block; background: #f5f5f5; padding: 10px; margin-top: 10px; border-radius: 5px;">
            POST https://your-server.com/webhook/tally
          </code>
        </div>
      </div>
    </div>

    <!-- ìˆ˜ë™ ì…ë ¥ íƒ­ -->
    <div id="manual" class="content">
      <div class="card">
        <h2>í™˜ì ì •ë³´ ìˆ˜ë™ ì…ë ¥</h2>
        <form id="patientForm">
          <!-- ê¸°ë³¸ ì •ë³´ -->
          <div class="form-section">
            <h3>ê¸°ë³¸ ì •ë³´</h3>
            <div class="form-grid">
              <div class="form-group">
                <label>ì„±ëª…</label>
                <input type="text" name="name" required>
              </div>
              <div class="form-group">
                <label>ì„±ë³„</label>
                <select name="gender">
                  <option value="">ì„ íƒ</option>
                  <option value="ë‚¨ì„±">ë‚¨ì„±</option>
                  <option value="ì—¬ì„±">ì—¬ì„±</option>
                </select>
              </div>
              <div class="form-group">
                <label>ë‚˜ì´</label>
                <input type="number" name="age" min="0" max="120">
              </div>
              <div class="form-group">
                <label>ì§ì—…</label>
                <input type="text" name="occupation">
              </div>
              <div class="form-group">
                <label>í‚¤ (cm)</label>
                <input type="number" name="height" min="0" max="250">
              </div>
              <div class="form-group">
                <label>ì²´ì¤‘ (kg)</label>
                <input type="number" name="weight" min="0" max="300">
              </div>
            </div>
          </div>

          <!-- ì£¼ì†Œ (ì£¼ìš” ì¦ìƒ) -->
          <div class="form-section">
            <h3>ì£¼ì†Œ (ì£¼ìš” í˜¸ì†Œ ì¦ìƒ)</h3>
            <div class="form-group">
              <label>1ìˆœìœ„ ì¦ìƒ (ì¦ìƒê³¼ ê¸°ê°„ì„ í•¨ê»˜ ì ì–´ì£¼ì„¸ìš”)</label>
              <textarea name="mainSymptom1" placeholder="ì˜ˆ: ë‘í†µ 3ê°œì›”, ìŠ¤íŠ¸ë ˆìŠ¤ ë°›ìœ¼ë©´ ì‹¬í•´ì§"></textarea>
            </div>
            <div class="form-group">
              <label>2ìˆœìœ„ ì¦ìƒ</label>
              <textarea name="mainSymptom2"></textarea>
            </div>
            <div class="form-group">
              <label>3ìˆœìœ„ ì¦ìƒ</label>
              <textarea name="mainSymptom3"></textarea>
            </div>
          </div>

          <!-- ë³‘ë ¥ -->
          <div class="form-section">
            <h3>ë³µìš©ì•½ ë° ë³‘ë ¥</h3>
            <div class="form-group">
              <label>í˜„ì¬ ë³µìš© ì¤‘ì¸ ì•½/ê±´ê°•ì‹í’ˆ</label>
              <textarea name="currentMedication"></textarea>
            </div>
            <div class="form-group">
              <label>ê³¼ê±°/í˜„ì¬ ë³‘ë ¥ ë° ìˆ˜ìˆ  ì´ë ¥</label>
              <textarea name="medicalHistory"></textarea>
            </div>
            <div class="form-group">
              <label>ê°€ì¡±ë ¥</label>
              <textarea name="familyHistory"></textarea>
            </div>
          </div>

          <!-- í•œì—´ -->
          <div class="form-section">
            <h3>í•œì—´ (å¯’ç†±)</h3>
            <div class="form-grid">
              <div class="form-group">
                <label>ì¶”ìœ„ ë¯¼ê°ë„</label>
                <select name="coldSensitivity">
                  <option value="">ì„ íƒ</option>
                  <option value="ì¶”ìœ„ë¥¼ ì•ˆ íƒ„ë‹¤">ì¶”ìœ„ë¥¼ ì•ˆ íƒ„ë‹¤</option>
                  <option value="ì•½ê°„ íƒ„ë‹¤">ì•½ê°„ íƒ„ë‹¤</option>
                  <option value="ë³´í†µ íƒ„ë‹¤">ë³´í†µ íƒ„ë‹¤</option>
                  <option value="ë§ì´ íƒ„ë‹¤">ë§ì´ íƒ„ë‹¤</option>
                  <option value="ì–´ë§ˆì–´ë§ˆí•˜ê²Œ íƒ„ë‹¤">ì–´ë§ˆì–´ë§ˆí•˜ê²Œ íƒ„ë‹¤</option>
                </select>
              </div>
              <div class="form-group">
                <label>ë”ìœ„ ë¯¼ê°ë„</label>
                <select name="heatSensitivity">
                  <option value="">ì„ íƒ</option>
                  <option value="ë”ìœ„ë¥¼ ì•ˆ íƒ„ë‹¤">ë”ìœ„ë¥¼ ì•ˆ íƒ„ë‹¤</option>
                  <option value="ì•½ê°„ íƒ„ë‹¤">ì•½ê°„ íƒ„ë‹¤</option>
                  <option value="ë³´í†µ íƒ„ë‹¤">ë³´í†µ íƒ„ë‹¤</option>
                  <option value="ë§ì´ íƒ„ë‹¤">ë§ì´ íƒ„ë‹¤</option>
                  <option value="ì–´ë§ˆì–´ë§ˆí•˜ê²Œ íƒ„ë‹¤">ì–´ë§ˆì–´ë§ˆí•˜ê²Œ íƒ„ë‹¤</option>
                </select>
              </div>
              <div class="form-group">
                <label>ì¶”ìœ„ vs ë”ìœ„</label>
                <select name="coldVsHeat">
                  <option value="">ì„ íƒ</option>
                  <option value="ì¶”ìœ„ë¥¼ ë” íƒ„ë‹¤">ì¶”ìœ„ë¥¼ ë” íƒ„ë‹¤</option>
                  <option value="ë”ìœ„ë¥¼ ë” íƒ„ë‹¤">ë”ìœ„ë¥¼ ë” íƒ„ë‹¤</option>
                  <option value="ë¹„ìŠ·í•˜ë‹¤">ë¹„ìŠ·í•˜ë‹¤</option>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label>ì°¨ê°€ìš´ ë¶€ìœ„</label>
              <div class="checkbox-group">
                <label><input type="checkbox" name="coldAreas" value="ì†"> ì†</label>
                <label><input type="checkbox" name="coldAreas" value="ë°œ"> ë°œ</label>
                <label><input type="checkbox" name="coldAreas" value="ì•„ë«ë°°"> ì•„ë«ë°°</label>
                <label><input type="checkbox" name="coldAreas" value="ì „ì‹ "> ì „ì‹ </label>
              </div>
            </div>
          </div>

          <!-- ë•€ -->
          <div class="form-section">
            <h3>í•œì¶œ (æ±—å‡º)</h3>
            <div class="form-grid">
              <div class="form-group">
                <label>ë•€ ì–‘</label>
                <select name="sweatAmount">
                  <option value="">ì„ íƒ</option>
                  <option value="ì ê²Œ ë‚œë‹¤">ì ê²Œ ë‚œë‹¤</option>
                  <option value="ë³´í†µì´ë‹¤">ë³´í†µì´ë‹¤</option>
                  <option value="ë§ì´ ë‚œë‹¤">ë§ì´ ë‚œë‹¤</option>
                </select>
              </div>
              <div class="form-group">
                <label>ë•€ í›„ ìƒíƒœ</label>
                <select name="sweatEffect">
                  <option value="">ì„ íƒ</option>
                  <option value="ëª¸ì´ ê°€ë³ê³  ê°œìš´í•˜ë‹¤">ëª¸ì´ ê°€ë³ê³  ê°œìš´í•˜ë‹¤</option>
                  <option value="ë‚˜ë¥¸í•˜ê³  ì§€ì¹œë‹¤">ë‚˜ë¥¸í•˜ê³  ì§€ì¹œë‹¤</option>
                  <option value="ë³„ ì°¨ì´ ì—†ë‹¤">ë³„ ì°¨ì´ ì—†ë‹¤</option>
                </select>
              </div>
            </div>
          </div>

          <!-- ìŒìˆ˜ -->
          <div class="form-section">
            <h3>ìŒìˆ˜ (é£®æ°´)</h3>
            <div class="form-grid">
              <div class="form-group">
                <label>í•˜ë£¨ ë¬¼ ì„­ì·¨ëŸ‰ (L)</label>
                <input type="number" name="waterIntake" min="0" max="10" step="0.5">
              </div>
              <div class="form-group">
                <label>ì„ í˜¸ ë¬¼ ì˜¨ë„</label>
                <select name="waterTemperature">
                  <option value="">ì„ íƒ</option>
                  <option value="ì°¬ë¬¼ì´ë‚˜ ì–¼ìŒë¬¼">ì°¬ë¬¼ì´ë‚˜ ì–¼ìŒë¬¼</option>
                  <option value="ìƒì˜¨ìˆ˜">ìƒì˜¨ìˆ˜(ë¯¸ì§€ê·¼í•œ ë¬¼)</option>
                  <option value="ë”°ëœ»í•œ ë¬¼">ë”°ëœ»í•œ ë¬¼</option>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label>ê°ˆì¦/êµ¬ê°•ê±´ì¡°</label>
              <div class="checkbox-group">
                <label><input type="checkbox" name="thirst" value="ëª©ì´ ìì£¼ ë§ˆë¥´ë‹¤"> ëª©ì´ ìì£¼ ë§ˆë¥´ë‹¤</label>
                <label><input type="checkbox" name="thirst" value="ì…ìˆ /í”¼ë¶€ê°€ ê±´ì¡°í•˜ë‹¤"> ì…ìˆ /í”¼ë¶€ê°€ ê±´ì¡°í•˜ë‹¤</label>
                <label><input type="checkbox" name="thirst" value="ì…ì•ˆì´ ë°”ì§ ë§ˆë¥¸ë‹¤"> ì…ì•ˆì´ ë°”ì§ ë§ˆë¥¸ë‹¤</label>
              </div>
            </div>
          </div>

          <!-- ì‹ìš•/ì†Œí™” -->
          <div class="form-section">
            <h3>ì‹ìš•/ì†Œí™”</h3>
            <div class="form-grid">
              <div class="form-group">
                <label>í•˜ë£¨ ì‹ì‚¬ íšŸìˆ˜</label>
                <input type="number" name="mealsPerDay" min="0" max="10">
              </div>
              <div class="form-group">
                <label>ì‹ìš•</label>
                <select name="appetite">
                  <option value="">ì„ íƒ</option>
                  <option value="ì—†ë‹¤">ì—†ë‹¤</option>
                  <option value="ë³´í†µì´ë‹¤">ë³´í†µì´ë‹¤</option>
                  <option value="ì¢‹ë‹¤">ì¢‹ë‹¤</option>
                </select>
              </div>
              <div class="form-group">
                <label>ì‹ì‚¬ëŸ‰</label>
                <select name="eatingAmount">
                  <option value="">ì„ íƒ</option>
                  <option value="ì ë‹¤">ì ë‹¤</option>
                  <option value="ë³´í†µì´ë‹¤">ë³´í†µì´ë‹¤</option>
                  <option value="ë§ë‹¤">ë§ë‹¤</option>
                </select>
              </div>
              <div class="form-group">
                <label>ì†Œí™” ê¸°ëŠ¥</label>
                <select name="digestion">
                  <option value="">ì„ íƒ</option>
                  <option value="ë‚˜ìœ í¸ì´ë‹¤">ë‚˜ìœ í¸ì´ë‹¤</option>
                  <option value="ë³´í†µì´ë‹¤">ë³´í†µì´ë‹¤</option>
                  <option value="ì¢‹ì€ í¸ì´ë‹¤">ì¢‹ì€ í¸ì´ë‹¤</option>
                </select>
              </div>
            </div>
          </div>

          <!-- ëŒ€ë³€ -->
          <div class="form-section">
            <h3>ëŒ€ë³€</h3>
            <div class="form-grid">
              <div class="form-group">
                <label>ë°°ë³€ ë¹ˆë„</label>
                <select name="bowelFrequency">
                  <option value="">ì„ íƒ</option>
                  <option value="í•˜ë£¨ í•œë²ˆ">í•˜ë£¨ í•œë²ˆ</option>
                  <option value="í•˜ë£¨ 2ë²ˆ">í•˜ë£¨ 2ë²ˆ</option>
                  <option value="í•˜ë£¨ 3ë²ˆì´ìƒ">í•˜ë£¨ 3ë²ˆì´ìƒ</option>
                  <option value="2-3ì¼ì— í•œë²ˆ">2-3ì¼ì— í•œë²ˆ</option>
                  <option value="4-5ì¼ì— í•œë²ˆ">4-5ì¼ì— í•œë²ˆ</option>
                  <option value="ì¼ì£¼ì¼ì— í•œë²ˆê¼´">ì¼ì£¼ì¼ì— í•œë²ˆê¼´</option>
                  <option value="ë¶ˆê·œì¹™ì ">ë¶ˆê·œì¹™ì </option>
                </select>
              </div>
              <div class="form-group">
                <label>ë³€ ìƒíƒœ</label>
                <select name="stoolConsistency">
                  <option value="">ì„ íƒ</option>
                  <option value="ë”±ë”±í•œ í¸">ë”±ë”±í•œ í¸</option>
                  <option value="ë³´í†µ">ë³´í†µ</option>
                  <option value="ë¬´ë¥¸ í¸">ë¬´ë¥¸ í¸</option>
                </select>
              </div>
              <div class="form-group">
                <label>ì„¤ì‚¬</label>
                <select name="diarrhea">
                  <option value="">ì„ íƒ</option>
                  <option value="ê±°ì˜ ì•ˆ í•œë‹¤">ê±°ì˜ ì•ˆ í•œë‹¤</option>
                  <option value="ê°€ë” í•œë‹¤">ê°€ë” í•œë‹¤</option>
                  <option value="ìì£¼ í•œë‹¤">ìì£¼ í•œë‹¤</option>
                </select>
              </div>
            </div>
          </div>

          <!-- ì†Œë³€ -->
          <div class="form-section">
            <h3>ì†Œë³€</h3>
            <div class="form-grid">
              <div class="form-group">
                <label>ì£¼ê°„ ì†Œë³€ íšŸìˆ˜</label>
                <input type="number" name="urinationDay" min="0" max="30">
              </div>
              <div class="form-group">
                <label>ì•¼ê°„ ì†Œë³€ íšŸìˆ˜</label>
                <input type="number" name="urinationNight" min="0" max="10">
              </div>
              <div class="form-group">
                <label>ë¶€ì¢…</label>
                <select name="edema">
                  <option value="">ì„ íƒ</option>
                  <option value="ê±°ì˜ ì•ˆ ë¶“ëŠ”ë‹¤">ê±°ì˜ ì•ˆ ë¶“ëŠ”ë‹¤</option>
                  <option value="ê°€ë” ë¶“ëŠ”ë‹¤">ê°€ë” ë¶“ëŠ”ë‹¤</option>
                  <option value="ìì£¼ ë¶“ëŠ”ë‹¤">ìì£¼ ë¶“ëŠ”ë‹¤</option>
                </select>
              </div>
            </div>
          </div>

          <!-- ìˆ˜ë©´ -->
          <div class="form-section">
            <h3>ìˆ˜ë©´</h3>
            <div class="form-grid">
              <div class="form-group">
                <label>ìˆ˜ë©´ ì‹œê°„</label>
                <input type="number" name="sleepHours" min="0" max="24" step="0.5">
              </div>
              <div class="form-group">
                <label>ìˆ˜ë©´ì˜ ì§ˆ</label>
                <select name="sleepQuality">
                  <option value="">ì„ íƒ</option>
                  <option value="ì¢‹ë‹¤">ì¢‹ë‹¤</option>
                  <option value="ë³´í†µì´ë‹¤">ë³´í†µì´ë‹¤</option>
                  <option value="ë‚˜ì˜ë‹¤">ë‚˜ì˜ë‹¤</option>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label>ìˆ˜ë©´ ë¬¸ì œ</label>
              <div class="checkbox-group">
                <label><input type="checkbox" name="sleepProblems" value="ì…ë©´ì¥ì• "> ì ë“¤ê¸° ì–´ë ¤ì›€</label>
                <label><input type="checkbox" name="sleepProblems" value="ì¤‘ê°„ê°ì„±"> ìì£¼ ê¹¸</label>
                <label><input type="checkbox" name="sleepProblems" value="ì¡°ê¸°ê°ì„±"> ë„ˆë¬´ ì¼ì° ê¹¸</label>
                <label><input type="checkbox" name="sleepProblems" value="ì–•ì€ì "> ì–•ì€ ì </label>
              </div>
            </div>
          </div>

          <!-- ë‘í†µ/í˜„í›ˆ -->
          <div class="form-section">
            <h3>ë‘í†µ/í˜„í›ˆ</h3>
            <div class="form-grid">
              <div class="form-group">
                <label>ë‘í†µ</label>
                <select name="headache">
                  <option value="">ì„ íƒ</option>
                  <option value="ì—†ë‹¤">ì—†ë‹¤</option>
                  <option value="ê°€ë” ìˆë‹¤">ê°€ë” ìˆë‹¤</option>
                  <option value="ìì£¼ ìˆë‹¤">ìì£¼ ìˆë‹¤</option>
                </select>
              </div>
              <div class="form-group">
                <label>ë‘í†µ ë¶€ìœ„</label>
                <input type="text" name="headacheLocation" placeholder="ì˜ˆ: ì „ë‘ë¶€, ì¸¡ë‘ë¶€, í›„ë‘ë¶€">
              </div>
              <div class="form-group">
                <label>ì–´ì§€ëŸ¬ì›€</label>
                <select name="dizziness">
                  <option value="">ì„ íƒ</option>
                  <option value="ì—†ë‹¤">ì—†ë‹¤</option>
                  <option value="ê°€ë” ìˆë‹¤">ê°€ë” ìˆë‹¤</option>
                  <option value="ìì£¼ ìˆë‹¤">ìì£¼ ìˆë‹¤</option>
                </select>
              </div>
            </div>
          </div>

          <!-- ì •ì‹ /ê°ì • -->
          <div class="form-section">
            <h3>ì •ì‹ /ê°ì •</h3>
            <div class="form-grid">
              <div class="form-group">
                <label>ìŠ¤íŠ¸ë ˆìŠ¤</label>
                <select name="stress">
                  <option value="">ì„ íƒ</option>
                  <option value="ì ë‹¤">ì ë‹¤</option>
                  <option value="ë³´í†µì´ë‹¤">ë³´í†µì´ë‹¤</option>
                  <option value="ë§ë‹¤">ë§ë‹¤</option>
                </select>
              </div>
              <div class="form-group">
                <label>ë¶ˆì•ˆ</label>
                <select name="anxiety">
                  <option value="">ì„ íƒ</option>
                  <option value="ì—†ë‹¤">ì—†ë‹¤</option>
                  <option value="ê°€ë” ìˆë‹¤">ê°€ë” ìˆë‹¤</option>
                  <option value="ìì£¼ ìˆë‹¤">ìì£¼ ìˆë‹¤</option>
                </select>
              </div>
              <div class="form-group">
                <label>ìš°ìš¸</label>
                <select name="depression">
                  <option value="">ì„ íƒ</option>
                  <option value="ì—†ë‹¤">ì—†ë‹¤</option>
                  <option value="ê°€ë” ìˆë‹¤">ê°€ë” ìˆë‹¤</option>
                  <option value="ìì£¼ ìˆë‹¤">ìì£¼ ìˆë‹¤</option>
                </select>
              </div>
            </div>
          </div>

          <!-- ì—¬ì„±ê±´ê°• -->
          <div class="form-section" id="femaleSection">
            <h3>ì—¬ì„±ê±´ê°• (ì—¬ì„±ë§Œ í•´ë‹¹)</h3>
            <div class="form-grid">
              <div class="form-group">
                <label>ìƒë¦¬ ìœ ë¬´</label>
                <select name="menstruation">
                  <option value="">ì„ íƒ</option>
                  <option value="ì •ìƒ">ì •ìƒ</option>
                  <option value="ë¶ˆê·œì¹™">ë¶ˆê·œì¹™</option>
                  <option value="íê²½">íê²½</option>
                </select>
              </div>
              <div class="form-group">
                <label>ìƒë¦¬ ì£¼ê¸°</label>
                <input type="text" name="menstrualCycle" placeholder="ì˜ˆ: 28ì¼">
              </div>
              <div class="form-group">
                <label>ìƒë¦¬ëŸ‰</label>
                <select name="menstrualAmount">
                  <option value="">ì„ íƒ</option>
                  <option value="ì ë‹¤">ì ë‹¤</option>
                  <option value="ë³´í†µ">ë³´í†µ</option>
                  <option value="ë§ë‹¤">ë§ë‹¤</option>
                </select>
              </div>
              <div class="form-group">
                <label>ìƒë¦¬í†µ</label>
                <select name="menstrualPain">
                  <option value="">ì„ íƒ</option>
                  <option value="ì—†ë‹¤">ì—†ë‹¤</option>
                  <option value="ì•½ê°„">ì•½ê°„</option>
                  <option value="ì‹¬í•˜ë‹¤">ì‹¬í•˜ë‹¤</option>
                </select>
              </div>
            </div>
          </div>

          <!-- ê¸°í˜¸ì‹í’ˆ -->
          <div class="form-section">
            <h3>ê¸°í˜¸ì‹í’ˆ</h3>
            <div class="form-grid">
              <div class="form-group">
                <label>ìŒì£¼ ë¹ˆë„</label>
                <select name="alcoholFrequency">
                  <option value="">ì„ íƒ</option>
                  <option value="ë§ˆì‹œì§€ ì•ŠëŠ”ë‹¤">ë§ˆì‹œì§€ ì•ŠëŠ”ë‹¤</option>
                  <option value="í•œë‹¬ì— 1-2ë²ˆ">í•œë‹¬ì— 1-2ë²ˆ</option>
                  <option value="ì¼ì£¼ì¼ì— 1-2ë²ˆ">ì¼ì£¼ì¼ì— 1-2ë²ˆ</option>
                  <option value="ì¼ì£¼ì¼ì— 3-4ë²ˆ">ì¼ì£¼ì¼ì— 3-4ë²ˆ</option>
                  <option value="ê±°ì˜ ë§¤ì¼">ê±°ì˜ ë§¤ì¼</option>
                </select>
              </div>
              <div class="form-group">
                <label>í¡ì—°</label>
                <select name="smoking">
                  <option value="">ì„ íƒ</option>
                  <option value="í”¼ìš°ì§€ ì•ŠëŠ”ë‹¤">í”¼ìš°ì§€ ì•ŠëŠ”ë‹¤</option>
                  <option value="ëŠì—ˆë‹¤">ëŠì—ˆë‹¤</option>
                  <option value="í”¼ìš´ë‹¤">í”¼ìš´ë‹¤</option>
                </select>
              </div>
            </div>
          </div>

          <div class="btn-group">
            <button type="submit" class="btn btn-primary">AI ë¶„ì„ ì‹œì‘</button>
            <button type="reset" class="btn btn-secondary">ì´ˆê¸°í™”</button>
          </div>
        </form>

        <div class="loading" id="loading">
          <div class="spinner"></div>
          <p>AIê°€ í™˜ì ì •ë³´ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
        </div>
      </div>
    </div>

    <!-- ë¶„ì„ ê²°ê³¼ íƒ­ -->
    <div id="results" class="content">
      <div class="card">
        <h2>ë¶„ì„ ê²°ê³¼</h2>

        <div id="noResults" style="text-align: center; padding: 40px; color: #666;">
          <p>ì•„ì§ ë¶„ì„ëœ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
          <p>ì„¤ë¬¸ ë°ì´í„°ë¥¼ ì…ë ¥í•˜ê±°ë‚˜ Tally ì„¤ë¬¸ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”.</p>
        </div>

        <div id="resultContent" style="display: none;">
          <div class="result-area">
            <h3>ğŸ“‹ ì°¨íŠ¸ ì¶œë ¥ (ë³µì‚¬í•˜ì—¬ EMRì— ë¶™ì—¬ë„£ê¸°)</h3>
            <div class="btn-group" style="margin-bottom: 15px;">
              <button class="btn btn-copy" onclick="copyChart()">ğŸ“‹ ì°¨íŠ¸ ë³µì‚¬</button>
              <button class="btn btn-secondary" onclick="copySimpleChart()">ğŸ“ ê°„ë‹¨ ë²„ì „ ë³µì‚¬</button>
            </div>
            <pre class="chart-output" id="chartOutput"></pre>
          </div>

          <div class="analysis-section">
            <h4>ğŸ” AI ë¶„ì„ ìƒì„¸</h4>
            <div id="analysisDetail"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // íƒ­ ì „í™˜
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));

        tab.classList.add('active');
        document.getElementById(tab.dataset.tab).classList.add('active');
      });
    });

    // í¼ ì œì¶œ
    document.getElementById('patientForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const formData = new FormData(e.target);
      const data = {};

      // ì¼ë°˜ í•„ë“œ ì²˜ë¦¬
      formData.forEach((value, key) => {
        if (data[key]) {
          // ì´ë¯¸ ê°’ì´ ìˆìœ¼ë©´ ë°°ì—´ë¡œ ë³€í™˜
          if (!Array.isArray(data[key])) {
            data[key] = [data[key]];
          }
          data[key].push(value);
        } else {
          data[key] = value;
        }
      });

      // ì²´í¬ë°•ìŠ¤ ë°°ì—´ ì²˜ë¦¬
      ['coldAreas', 'thirst', 'sleepProblems'].forEach(name => {
        const checkboxes = document.querySelectorAll(`input[name="${name}"]:checked`);
        if (checkboxes.length > 0) {
          data[name] = Array.from(checkboxes).map(cb => cb.value);
        }
      });

      // ë¡œë”© í‘œì‹œ
      document.getElementById('loading').classList.add('show');

      try {
        const response = await fetch('/api/analyze', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });

        const result = await response.json();

        if (result.success) {
          displayResults(result);
        } else {
          alert('ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + result.error);
        }
      } catch (error) {
        alert('ì„œë²„ ì—°ê²° ì˜¤ë¥˜: ' + error.message);
      } finally {
        document.getElementById('loading').classList.remove('show');
      }
    });

    // ê²°ê³¼ í‘œì‹œ
    function displayResults(result) {
      document.getElementById('noResults').style.display = 'none';
      document.getElementById('resultContent').style.display = 'block';
      document.getElementById('chartOutput').textContent = result.chartOutput;

      // ë¶„ì„ ìƒì„¸ í‘œì‹œ
      const analysis = result.analysis;
      let detailHtml = '';

      if (analysis.constitution) {
        detailHtml += `<p><strong>ì¶”ì • ì²´ì§ˆ:</strong> ${analysis.constitution.type} (ì‹ ë¢°ë„: ${analysis.constitution.confidence})</p>`;
        detailHtml += `<p><strong>ê·¼ê±°:</strong> ${analysis.constitution.rationale}</p>`;
      }

      if (analysis.eightPrinciples) {
        const ep = analysis.eightPrinciples;
        detailHtml += `<p><strong>íŒ”ê°•ë³€ì¦:</strong> ${ep.yinYang}/${ep.exteriorInterior}/${ep.coldHeat}/${ep.deficiencyExcess}</p>`;
        if (ep.summary) detailHtml += `<p>${ep.summary}</p>`;
      }

      if (analysis.expectedConditions) {
        detailHtml += `<p><strong>ì˜ˆìƒ ì§ˆí™˜:</strong> ${analysis.expectedConditions.join(', ')}</p>`;
      }

      if (analysis.recommendedPrescriptions) {
        detailHtml += `<p><strong>ì¶”ì²œ ì²˜ë°© í›„ë³´:</strong> ${analysis.recommendedPrescriptions.join(', ')}</p>`;
      }

      document.getElementById('analysisDetail').innerHTML = detailHtml;

      // ê²°ê³¼ íƒ­ìœ¼ë¡œ ì´ë™
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
      document.querySelector('[data-tab="results"]').classList.add('active');
      document.getElementById('results').classList.add('active');

      // ì „ì—­ì— ì €ì¥ (ë³µì‚¬ìš©)
      window.lastResult = result;
    }

    // ì°¨íŠ¸ ë³µì‚¬
    function copyChart() {
      const text = document.getElementById('chartOutput').textContent;
      navigator.clipboard.writeText(text).then(() => {
        alert('ì°¨íŠ¸ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
      });
    }

    // ê°„ë‹¨ ì°¨íŠ¸ ë³µì‚¬
    function copySimpleChart() {
      if (window.lastResult && window.lastResult.chartOutput) {
        // ê°„ë‹¨ ë²„ì „ ìƒì„± (ì´ëª¨ì§€ì™€ êµ¬ë¶„ì„  ì œê±°)
        let simple = window.lastResult.chartOutput
          .replace(/â”+/g, '')
          .replace(/[ğŸ“‹ğŸ”â—†â€»]/g, '')
          .replace(/\n{3,}/g, '\n\n')
          .trim();

        navigator.clipboard.writeText(simple).then(() => {
          alert('ê°„ë‹¨ ë²„ì „ì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
        });
      }
    }
  </script>
</body>
</html>
